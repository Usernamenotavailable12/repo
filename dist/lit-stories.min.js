var w=Object.freeze,b=Object.defineProperty,Y=(t,n,i)=>n in t?b(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i,g=(t,n,i)=>Y(t,"symbol"!=typeof n?n+"":n,i),a=(t,n)=>w(b(t,"raw",{value:w(n||t.slice())}));function B(){import.meta.url,import("_").catch((()=>1)),async function*(){}().next()}const{LitElement:z,html:l,css:R}=window.Lit;var x,y,T,V,E,k,P,I,S,$,M,L,A,N,X,C,F,O,U;class p extends z{constructor(){super(),g(this,"_onStageTransitionEnd",(t=>{this._transition&&(this._transition=null)})),this.locale=document.documentElement.lang||"en",this.slides=[],this._isViewing=!1,this._currentIndex=0,this._isPaused=!1,this._progressMs=0,this._progressFraction=0,this._transition=null,this._loading=!0,this._error=null,this._rafId=null,this._autoTimer=null,this._storyDuration=5e3,this._currentVideoEl=null,this._videoRafId=null,this._onVideoEnded=null,this._viewed=new Set,this._touch={active:!1,startX:0,startY:0,lastX:0,lastY:0,startTime:0,moved:!1},this._stageEl=null,this._touchListenersAttached=!1,this._boundTouchStart=this._onViewerTouchStart.bind(this),this._boundTouchMove=this._onViewerTouchMove.bind(this),this._boundTouchEnd=this._onViewerTouchEnd.bind(this)}connectedCallback(){super.connectedCallback(),window.__storiesLoadedOnce||(sessionStorage.removeItem("stories-carousel-cache"),window.__storiesLoadedOnce=!0),this._fetchStories()}disconnectedCallback(){super.disconnectedCallback(),this._clearTimers(),this._detachStageListeners()}updated(t){this._isViewing?this._attachStageListeners():this._detachStageListeners()}_attachStageListeners(){var t;const n=null==(t=this.renderRoot)?void 0:t.querySelector(".stage");if(!n||(this._stageEl&&this._stageEl!==n&&this._detachStageListeners(),this._touchListenersAttached))return;this._stageEl=n;const i={passive:!0};n.addEventListener("touchstart",this._boundTouchStart,i),n.addEventListener("touchmove",this._boundTouchMove,i),n.addEventListener("touchend",this._boundTouchEnd,i),n.addEventListener("touchcancel",this._boundTouchEnd,i),this._touchListenersAttached=!0}_detachStageListeners(){this._stageEl&&(this._stageEl.removeEventListener("touchstart",this._boundTouchStart),this._stageEl.removeEventListener("touchmove",this._boundTouchMove),this._stageEl.removeEventListener("touchend",this._boundTouchEnd),this._stageEl.removeEventListener("touchcancel",this._boundTouchEnd),this._touchListenersAttached=!1,this._stageEl=null)}async _fetchStories(){var t,n;this._loading=!0,this._error=null;try{const i=sessionStorage.getItem("stories-carousel-cache");if(i)try{const t=JSON.parse(i);if(Array.isArray(t))return this.slides=t,void(this._loading=!1)}catch(t){}const e="\n      query GetStories($locale: String!) {\n        getStoriesList(locale: $locale, onlyEnabled: true, size: 200) {\n          items {\n            caption\n            sortOrder\n            NavigateVar\n            OptionalHref\n            NavigateParams\n            content { path }\n            thumbnail { path }\n            Georgians\n          }\n        }\n      }\n      ".trim(),s=await fetch("https://api.takeshape.io/project/f2b70d9b-56f9-4d2d-be98-874fcbc02a46/production/graphql",{method:"POST",headers:{"Content-Type":"application/json","X-TakeShape-Token":"d51354712676485f94578c5714b1c466"},body:JSON.stringify({query:e,variables:{locale:this.locale||"en"}})});if(!s.ok)throw new Error("Network error: ".concat(s.status," ").concat(s.statusText));const r=await s.json();if(r.errors)throw new Error("GraphQL errors: ".concat(JSON.stringify(r.errors)));const a=(null==(n=null==(t=null==r?void 0:r.data)?void 0:t.getStoriesList)?void 0:n.items)||[];a.sort(((t,n)=>{var i,e;return Number(null!=(i=null==t?void 0:t.sortOrder)?i:0)-Number(null!=(e=null==n?void 0:n.sortOrder)?e:0)})),this.slides=a;try{sessionStorage.setItem("stories-carousel-cache",JSON.stringify(a))}catch(t){}}catch(t){console.error("Error fetching stories:",t),this._error=String(t)}finally{this._loading=!1}}fixUrl(t){return t&&"string"==typeof t?t.replace(/^\//,""):""}isVideoPath(t){const n=(t||"").toLowerCase();return/\.(mp4|mov|webm|mkv|avi|wmv)(\?.*)?$/.test(n)}isVideoSlide(t){var n;return this.isVideoPath(null==(n=null==t?void 0:t.content)?void 0:n.path)}_fullUrl(t){var n;const i=this.fixUrl((null==(n=null==t?void 0:t.content)?void 0:n.path)||"");return"https://www.ambassadoribet.com/_internal/ts-images/".concat(i,"/?auto=format%2Ccompress")}_thumbUrl(t){var n;const i=this.fixUrl((null==(n=null==t?void 0:t.thumbnail)?void 0:n.path)||"");return"https://www.ambassadoribet.com/_internal/ts-images/".concat(i,"/?auto=format%2Ccompress")}_openViewer(t){var n;null!=(n=this.slides)&&n.length&&(this._isViewing=!0,this._currentIndex=Math.max(0,Math.min(t,this.slides.length-1)),this._markViewed(this._currentIndex),this._transition=null,this._progressMs=0,this._progressFraction=0,this._isPaused=!1,this._startProgress())}_closeViewer(){this._isViewing=!1,this._clearTimers(),this._transition=null,this._progressMs=0,this._progressFraction=0,this._isPaused=!1}_togglePause(){this._isViewing&&(this._isPaused?(this._isPaused=!1,this._startProgress()):(this._isPaused=!0,this._stopProgressKeepPosition()))}_markViewed(t){this._viewed.add(t),this.requestUpdate()}_next(){if(this._isPaused)return;if(this._currentIndex>=this.slides.length-1)return void this._closeViewer();const t=this._currentIndex+1;this._animateTo(t,"right")}_prev(){if(this._isPaused)return;if(this._currentIndex<=0)return void this._closeViewer();const t=this._currentIndex-1;this._animateTo(t,"left")}_animateTo(t,n="right"){const i=this._currentIndex;this._currentIndex=t,this._markViewed(this._currentIndex),this._transition={prevIndex:i,currentIndex:t,direction:n,animating:!0},this._progressMs=0,this._progressFraction=0,this._isPaused=!1,this._startProgress();window.clearTimeout(this._cleanupTimer),this._cleanupTimer=window.setTimeout((()=>{this._transition=null}),800)}async _startProgress(){var t;this._clearTimers();const n=this.slides[this._currentIndex];if(this.isVideoSlide(n)){await this.updateComplete;const n=null==(t=this.renderRoot)?void 0:t.getElementById("currentVideo");if(!n)return;this._currentVideoEl=n;const i=()=>{if(!this._currentVideoEl||this._isPaused||!this._isViewing)return;const t=this._currentVideoEl.duration||0,n=this._currentVideoEl.currentTime||0;this._progressMs=t?1e3*n:0,this._progressFraction=t?Math.min(1,n/t):0,this.requestUpdate(),this._videoRafId=window.requestAnimationFrame(i)},e=()=>{this._videoRafId&&(window.cancelAnimationFrame(this._videoRafId),this._videoRafId=null),this._next()};if(this._onVideoEnded=e,this._currentVideoEl.addEventListener("ended",e),!this._isPaused){try{await this._currentVideoEl.play()}catch(t){}this._videoRafId=window.requestAnimationFrame(i)}return}const i=Math.max(0,this._storyDuration-this._progressMs),e=performance.now()-this._progressMs,s=t=>{if(this._isPaused||!this._isViewing)return;const n=t-e;this._progressMs=Math.min(this._storyDuration,n),this._progressFraction=this._progressMs/this._storyDuration,this.requestUpdate(),this._progressMs>=this._storyDuration?(this._rafId=null,this._autoTimer=window.setTimeout((()=>this._next()),0)):this._rafId=window.requestAnimationFrame(s)};this._rafId=window.requestAnimationFrame(s),this._autoTimer=window.setTimeout((()=>{!this._isPaused&&this._isViewing&&(this._progressMs=this._storyDuration,this._progressFraction=1,this.requestUpdate(),this._next())}),i+30)}_stopProgressKeepPosition(){if(this._rafId&&(window.cancelAnimationFrame(this._rafId),this._rafId=null),this._autoTimer&&(window.clearTimeout(this._autoTimer),this._autoTimer=null),this._currentVideoEl)try{this._currentVideoEl.pause()}catch(t){}this._videoRafId&&(window.cancelAnimationFrame(this._videoRafId),this._videoRafId=null)}_clearTimers(){if(this._rafId&&(window.cancelAnimationFrame(this._rafId),this._rafId=null),this._autoTimer&&(window.clearTimeout(this._autoTimer),this._autoTimer=null),this._cleanupTimer&&(window.clearTimeout(this._cleanupTimer),this._cleanupTimer=null),this._currentVideoEl&&this._onVideoEnded)try{this._currentVideoEl.removeEventListener("ended",this._onVideoEnded)}catch(t){}if(this._currentVideoEl)try{this._currentVideoEl.pause()}catch(t){}this._videoRafId&&(window.cancelAnimationFrame(this._videoRafId),this._videoRafId=null),this._currentVideoEl=null,this._onVideoEnded=null}_onViewerTouchStart(t){if(!this._isViewing)return;const n=t.touches[0];this._touch.active=!0,this._touch.startX=n.clientX,this._touch.startY=n.clientY,this._touch.lastX=n.clientX,this._touch.lastY=n.clientY,this._touch.startTime=performance.now(),this._touch.moved=!1,this._isPaused?this._wasPausedByTouch=!1:(this._togglePause(),this._wasPausedByTouch=!0)}_onViewerTouchMove(t){if(!this._touch.active)return;const n=t.touches[0],i=n.clientX-this._touch.startX,e=n.clientY-this._touch.startY;this._touch.lastX=n.clientX,this._touch.lastY=n.clientY,Math.hypot(i,e)>10&&(this._touch.moved=!0)}_onViewerTouchEnd(t){if(!this._touch.active)return;const n=this._touch.lastX-this._touch.startX,i=this._touch.lastY-this._touch.startY,e=performance.now()-this._touch.startTime,s=Math.abs(n),r=Math.abs(i),a=s>50&&s>r,o=e<200&&Math.hypot(n,i)<30;if(a)(!this._isPaused||this._wasPausedByTouch)&&(n<0?this._next():this._prev());else if(o){const t=this._touch.startX,n=window.innerWidth/3;!this._isPaused||this._wasPausedByTouch?t<n?this._prev():t>2*n?this._next():this._handleNavigateCurrent():t>=n&&t<=2*n&&this._handleNavigateCurrent()}this._wasPausedByTouch&&this._isPaused&&this._togglePause(),this._touch.active=!1,this._wasPausedByTouch=!1}_onViewerClick(t){var n;if(!this._isViewing||((null==(n=t.composedPath)?void 0:n.call(t))||[]).some((t=>{var n,i;return null==(i=null==(n=null==t?void 0:t.classList)?void 0:n.contains)?void 0:i.call(n,"btn")})))return;const i=t.clientX,e=window.innerWidth/3;this._isPaused?i>=e&&i<=2*e&&this._handleNavigateCurrent():i<e?this._prev():i>2*e?this._next():this._handleNavigateCurrent()}handleNavigate(t){if(!window.TMA||"function"!=typeof window.TMA.navigate)return void console.warn("TMA.navigate is not available");const{NavigateVar:n,NavigateParams:i,OptionalHref:e}=t;try{if(i&&"string"==typeof i&&i.startsWith("game/")){const t=i.split("/");if(3===t.length&&t[1]&&t[2]){const[,n,i]=t;return void window.TMA.navigate("GAME",{gameStudio:n,gameSlug:i})}}if(n&&"NULL"!==n&&"null"!==n)return void window.TMA.navigate(n);console.debug("No TMA navigation triggered, relying on OptionalHref:",e)}catch(t){console.error("Error processing navigation:",t)}}_handleNavigateCurrent(){const t=this.slides[this._currentIndex];try{this.handleNavigate(t),null!=t&&t.OptionalHref&&"string"==typeof t.OptionalHref&&(window.location.href=t.OptionalHref)}catch(t){console.error("Navigation error:",t)}}_renderProgressBars(){const t=this.slides.length,n=this._currentIndex;return l(T||(T=a(['\n      <div class="progress">\n        ',"\n      </div>\n    "])),Array.from({length:t}).map(((t,i)=>{let e=0;return e=i<n?100:i===n?Math.round(100*this._progressFraction):0,l(y||(y=a(['\n            <div class="bar">\n              <div class="fill" style="width:','%"></div>\n            </div>\n          '])),e)})))}_renderStage(){var t,n;const i=this.slides[this._currentIndex],e=null==(t=this._transition)?void 0:t.prevIndex,s="number"==typeof e?this.slides[e]:null,r=null==(n=this._transition)?void 0:n.direction,o=this._transition?"right"===r?"img-layer enter-right":"img-layer enter-left":"img-layer active",h=this._transition?"right"===r?"img-layer active exit-left":"img-layer active exit-right":"",d=!!s&&this.isVideoSlide(s),c=!!i&&this.isVideoSlide(i);return l(M||(M=a(['\n      <div\n        class="stage"\n        style="--bg-url: url(\'',"');\"\n        @click=","\n      >\n        ","\n        ",'\n        <div class="hit-areas" aria-hidden="true">\n          ','\n          <div class="hit"></div>\n          <div class="hit"></div>\n          <div class="hit"></div>\n        </div>\n      </div>\n    '])),this._thumbUrl(i),this._onViewerClick,s?l(k||(k=a(["\n              <div class=",">\n                ","\n              </div>\n            "])),h,l(d?V||(V=a(['<video\n                      class="img-el"\n                      src=','\n                      muted\n                      preload="metadata"\n                      playsinline\n                    ></video>'])):E||(E=a(['<img\n                      class="img-el"\n                      src=','\n                      alt=""\n                    />'])),this._fullUrl(s))):null,i?l(S||(S=a(["\n              <div\n                class=","\n                style=","\n                @transitionend=","\n              >\n                ","\n              </div>\n            "])),o,(this._transition,""),this._onStageTransitionEnd,l(c?P||(P=a(['<video\n                      id="currentVideo"\n                      class="img-el"\n                      src=',"\n                      muted\n                      playsinline\n                      autoplay\n                    ></video>"])):I||(I=a(['<img\n                      class="img-el"\n                      src=','\n                      alt=""\n                    />'])),this._fullUrl(i))):null,null!=i&&i.caption?l($||($=a(['<div class="caption">',"</div>"])),i.caption):null)}render(){var t;return this._loading?l(L||(L=a(['<div class="loading">Loading...</div>']))):this._error?l(A||(A=a([' <div class="loading">Loading...</div> ']))):null!=(t=this.slides)&&t.length?l(X||(X=a(["\n      ","\n    "])),this._isViewing?this._renderViewer():this._renderThumbnails()):l(N||(N=a(['<div class="loading">No stories found.</div>'])))}_renderThumbnails(){return l(O||(O=a(['\n      <div class="thumbs">\n        ',"\n      </div>\n    "])),this.slides.map(((t,n)=>{const i=this._viewed.has(n);return l(F||(F=a(['\n            <div class="thumb">\n              <button\n                class="thumb-btn"\n                @click=','\n                aria-label="Open story"\n              >\n                <div class="thumb-img-wrap ','">\n                  <img\n                    class="thumb-img"\n                    src=','\n                    alt=""\n                    loading="lazy"\n                  />\n                </div>\n                ',"\n              </button>\n            </div>\n          "])),(()=>this._openViewer(n)),i?"":"unviewed",this._thumbUrl(t),!0===t.Georgians?l(C||(C=a(['<div class="thumb-checkmark"></div>']))):"")})))}_renderViewer(){return l(U||(U=a(['\n      <div class="viewer">\n        <div class="top-bar">\n          ','\n          <div class="controls">\n            <button\n              class="btn play-pause"\n              @click=','\n              aria-label="Pause/Play"\n            >\n              ','\n            </button>\n            <button\n              class="btn close"\n              @click=','\n              aria-label="Close"\n            >\n              ×\n            </button>\n          </div>\n        </div>\n        ',"\n      </div>\n    "])),this._renderProgressBars(),this._togglePause,this._isPaused?"▶":"⏸",this._closeViewer,this._renderStage())}}g(p,"properties",{locale:{type:String},slides:{type:Array},_isViewing:{state:!0},_currentIndex:{state:!0},_isPaused:{state:!0},_progressMs:{state:!0},_progressFraction:{state:!0},_transition:{state:!0},_loading:{state:!0},_error:{state:!0}}),g(p,"styles",R(x||(x=a(['\n    :host {\n      display: block;\n      color: #fff;\n    }\n\n    /* Thumbnails row */\n    .thumbs {\n      display: flex;\n      gap: 8px;\n      overflow-x: auto;\n      padding: 12px;\n      scrollbar-width: thin;\n      -webkit-overflow-scrolling: touch;\n      background: transparent;\n      scrollbar-width: none;\n    }\n    .thumb {\n      flex: 0 0 auto;\n      width: fit-content;\n      text-align: center;\n      position: relative;\n    }\n    .thumb-img-wrap {\n      width: 90px;\n      height: 120px;\n      border-radius: 12px;\n      overflow: hidden;\n      border: 2px solid transparent;\n      outline: 2px solid gray;\n      box-sizing: border-box;\n      position: relative;\n    }\n    .thumb-img-wrap.unviewed {\n      outline: 2px solid #993463;\n    }\n    .thumb:has(.unviewed) {\n      --thumb-checkmark-bg: #993463;\n    }\n    .thumb-img {\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n      display: block;\n      background: #222;\n    }\n    .thumb-cap {\n      margin-top: 6px;\n      font-size: 11px;\n      color: #bbb;\n      max-width: 80px;\n      word-break: break-word;\n    }\n    .thumb-btn {\n      all: unset;\n      cursor: pointer;\n      display: inline-block;\n    }\n    .thumb-checkmark::before {\n      content: "#Georgians";\n      display: inline-block;\n      padding: 2px 20px 2px 6px;\n      background: var(--thumb-checkmark-bg, gray)\n        url(https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/6355bde9-b143-40af-afc1-9d8d5eada880/flag-for-flag-georgia-svgrepo-com.svg)\n        no-repeat right 4px center;\n      background-size: 12px auto;\n      border-radius: 64px;\n      color: #fff;\n      font-size: 8px;\n      line-height: 10px;\n      font-weight: 400;\n      font-family: "Noto Sans Ambassadori";\n      text-align: center;\n      position: absolute;\n      left: 50%;\n      top: -5px;\n      transform: translateX(-50%);\n    }\n\n    /* Fullscreen viewer */\n    .viewer {\n      position: fixed;\n      inset: 0;\n      background: #000;\n      display: flex;\n      flex-direction: column;\n      z-index: 2147483647;\n      perspective: 1000px;\n      overflow: hidden;\n      touch-action: none; /* we implement gestures */\n      margin-block: 60px;\n    }\n\n    /* Top controls row */\n    .top-bar {\n      position: absolute;\n      top: 10px;\n      left: 10px;\n      right: 10px;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      z-index: 3;\n      pointer-events: none;\n    }\n\n    .progress {\n      display: flex;\n      gap: 4px;\n      flex: 1 1 auto;\n      pointer-events: auto;\n    }\n    .bar {\n      position: relative;\n      height: 2px;\n      background: rgba(255, 255, 255, 0.3);\n      flex: 1 1 0;\n      overflow: hidden;\n      border-radius: 2px;\n    }\n    .bar .fill {\n      position: absolute;\n      left: 0;\n      top: 0;\n      height: 100%;\n      width: 0%;\n      background: #fff;\n      will-change: width;\n    }\n    .controls {\n      display: flex;\n      gap: 8px;\n      pointer-events: auto;\n    }\n    .btn {\n      all: unset;\n      color: #fff;\n      font-size: 20px;\n      cursor: pointer;\n      padding: 6px 10px;\n      background: rgba(255, 255, 255, 0.08);\n      border-radius: 8px;\n      line-height: 1;\n      user-select: none;\n      font-family: "Noto Sans Ambassadori Bold";\n      height: fit-content;\n      width: 25px;\n      text-align: center;\n    }\n    .btn:active {\n      transform: scale(0.98);\n    }\n\n    /* Image stage */\n    .stage {\n      position: relative;\n      width: 100vw;\n      height: 100vh;\n      display: grid;\n      place-items: center;\n      z-index: 1;\n    }\n    .img-layer {\n      position: absolute;\n      inset: 0;\n      display: grid;\n      place-items: center;\n      overflow: visible; /* allow 3D transforms to show */\n      backface-visibility: hidden;\n      will-change: transform, opacity;\n      transition: transform 0.4s ease-in-out, opacity 0.4s ease-in-out;\n      background-image: var(--bg-url);\n      background-size: cover;\n      background-position: center;\n    }\n    .img-el {\n      max-width: 80vw;\n      max-height: 80vh;\n      object-fit: contain;\n      display: block;\n      background: #111;\n      border-radius: 8px;\n      box-shadow: 0 0px 130px rgba(0, 0, 0, 1), 0 0px 130px rgba(0, 0, 0, 1);\n    }\n    .caption {\n      position: absolute;\n      top: 50px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 90vw;\n      text-align: center;\n      color: #fff;\n      font-size: 15px;\n      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);\n      z-index: 2;\n      background-color: rgba(0, 0, 0, 0.5);\n      padding: 4px 8px;\n      border-radius: 8px;\n      font-family: "Noto Sans Ambassadori";\n    }\n\n    /* 3D transition states */\n    .active {\n      transform: translateX(0) rotateY(0deg);\n      opacity: 1;\n    }\n    .enter-right {\n      transform: translateX(100%) rotateY(60deg);\n      opacity: 0;\n    }\n    .enter-left {\n      transform: translateX(-100%) rotateY(-60deg);\n      opacity: 0;\n    }\n    .exit-left {\n      transform: translateX(-100%) rotateY(-60deg);\n      opacity: 0;\n    }\n    .exit-right {\n      transform: translateX(100%) rotateY(60deg);\n      opacity: 0;\n    }\n\n    /* Overlay click/touch regions (for prev/next/middle) */\n    .hit-areas {\n      position: absolute;\n      inset: 0;\n      display: grid;\n      grid-template-columns: 1fr 1fr 1fr;\n      z-index: 2;\n    }\n    .hit {\n      /* invisible areas to receive clicks */\n      display: block;\n    }\n\n    /* Loading */\n    .loading {\n      color: #ccc;\n      padding: 16px;\n      font-size: 14px;\n      background: #000;\n    }\n  '])))),customElements.define("stories-carousel",p);export{B as __vite_legacy_guard};