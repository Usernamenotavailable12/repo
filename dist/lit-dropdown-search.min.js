var r=Object.freeze,b=Object.defineProperty,i=(e,n)=>r(b(e,"raw",{value:r(n||e.slice())}));function y(){import.meta.url,import("_").catch((()=>1)),async function*(){}().next()}const{LitElement:u,html:a,css:f}=window.Lit;var n,l,d,c,h,p,g;customElements.define("dropdown-game-search",class extends u{static get styles(){return f(n||(n=i(["\n      :host {\n        display: inline-flex;\n        font-family: 'Noto Sans Ambassadori';\n        padding-top: 5px;\n        margin: 0;\n        background: transparent;\n        justify-content: end;\n        position: relative;\n        width: 360px;\n        height: 35px;\n      }\n      .search-input {\n        width: 260px;\n        padding: 10px;\n        height: 35px;\n        padding-left: 40px; /* Space for the icon */\n        font-size: 16px;\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        border-radius: 64px;\n        box-sizing: border-box;\n        background: rgba(28, 9, 26, 1);\n        color: #fff;\n        font-family: 'Noto Sans Ambassadori';\n        transition: width 0.3s ease;\n      }\n      .search-input-icon {\n        content: url('https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/298a2099-37a5-41a0-83cb-c4a3f8e3dfee/footer-search.svg');\n        display: inline-block;\n        inset: 0px;\n        width: 17px;\n        transform: translateX(30px);\n        transition: left 0.3s ease;\n        pointer-events: none; /* Prevent clicks on the icon */\n      }\n      .search-input:focus {\n        outline: none;\n        border-color: rgba(255, 255, 255, 0.2);\n        box-shadow: 0 0 5px rgba(255, 255, 255, 0.2);\n        width: 360px; /* Expand to full width on focus */\n      }\n      .search-input:focus + .dropdown,\n      .dropdown.visible {\n        display: block;\n          visibility: visible;\n          opacity: 1;\n          transition-delay: 0s;\n      }\n      .dropdown {\n        position: absolute;\n        top: 120%;\n        left: 12.5px;\n        right: 0;\n        max-height: 320px;\n        width: 335px;\n        overflow-y: auto;\n        background: rgba(28, 9, 26, 1);\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        border-radius: 16px;\n        z-index: 1000;\n        padding: 5px;\n        scrollbar-width: none;\n        visibility: hidden;\n        opacity: 0;\n        transition: visibility 0s linear 0.2s, opacity 0.2s linear;\n        }\n        .dropdown.visible {\n        visibility: visible;\n        opacity: 1;\n        transition-delay: 0s;\n      }\n        \n      .game-item {\n        display: flex;\n        align-items: center;\n        padding: 10px;\n        cursor: pointer;\n        transition: background 0.2s;\n        scale: 1.03;\n      }\n      .game-item:hover {\n        background: #2F0E2C;\n      }\n      .game-item:hover:after {\n        content: url(\"https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/32ba5fe7-b5e4-41af-bb69-34e8ad1b5941/arrow-right.svg\");\n      }\n      .game-item img {\n        width: 80px;\n        height: 45px;\n        object-fit: cover;\n        border-radius: 4px;\n        margin-right: 10px;\n      }\n      .game-info {\n        flex: 1;\n      }\n      .game-info .studio-name {\n        font-size: 12px;\n        color: rgb(255, 255, 255, .6);\n      }\n      .game-info .game-name {\n        font-size: 14px;\n        font-weight: 500;\n        color: rgb(255, 255, 255, 1);\n      }\n      .loading {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        padding: 20px;\n      }\n      .spinner {\n        width: 32px;\n        height: 32px;\n        border: 3px solid #f3f3f3;\n        border-top: 3px solid #ff0099;\n        border-radius: 50%;\n        animation: spin 1s linear infinite;\n      }\n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n      .no-games {\n        text-align: center;\n        color: #333;\n        font-size: 14px;\n        padding: 20px;\n      }\n      .error {\n        text-align: center;\n        color: #ff0000;\n        font-size: 14px;\n        padding: 20px;\n      }\n      .sentinel {\n        height: 20px;\n      }\n    "])))}static get properties(){return{games:{type:Array},visibleGames:{type:Array},searchTerm:{type:String},isLoading:{type:Boolean},error:{type:String},isDropdownVisible:{type:Boolean},locale:{type:String},renderedGames:{type:Array},loadedCount:{type:Number}}}constructor(){super(),this.games=[],this.visibleGames=[],this.renderedGames=[],this.searchTerm="",this.isLoading=!1,this.error=null,this.isDropdownVisible=!1,this.CACHE_KEY="gameSearchData",this.locale="en",this.loadedCount=0,this.batchSize=10,this.scrollObserver=null,this.placeholders={en:"Search...",ka:"ძებნა...",ru:"Поиск...",tr:"Ara..."}}connectedCallback(){super.connectedCallback(),document.addEventListener("click",this.handleDocumentClick.bind(this)),this.loadCachedGames()}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("click",this.handleDocumentClick.bind(this)),this.scrollObserver&&(this.scrollObserver.disconnect(),this.scrollObserver=null)}clearDropdownContent(){this.renderedGames=[],this.loadedCount=0,this.isLoading=!1,this.error=null,this.requestUpdate()}handleDocumentClick(e){this.shadowRoot.contains(e.target)||(this.isDropdownVisible=!1)}handleInputFocus(){this.isDropdownVisible=!0,this.loadCachedGames(),this.fetchGames()}handleInputBlur(){setTimeout((()=>{!this.shadowRoot.querySelector(".search-input:focus")&&!this.shadowRoot.querySelector(".dropdown:hover")&&(this.isDropdownVisible=!1,this.clearDropdownContent())}),200)}loadCachedGames(){const e=this.getCachedGames();e&&(this.games=e,this.updateVisibleGames(),this.isLoading=!1)}async fetchGames(){this.games.length||(this.isLoading=!0),this.requestUpdate();try{const e=await(await fetch(API_URL,{method:"POST",headers:{"Content-Type":"application/json","tm-bid":"ab"},body:JSON.stringify({query:"\n            query LobbyConnection($lobbyId: ID) {\n              lobbyConnection(lobbyId: $lobbyId) {\n                edges {\n                  node {\n                    brandGames {\n                      slug\n                      studio\n                      name\n                    }\n                  }\n                }\n              }\n            }\n          ",variables:{lobbyId:"ab_all-games"}})})).json();if(!e.data||!e.data.lobbyConnection||!e.data.lobbyConnection.edges)throw new Error("Invalid response structure");const n=e.data.lobbyConnection.edges.flatMap((e=>e.node.brandGames));JSON.stringify(n)!==JSON.stringify(this.games)&&(this.games=n,this.setCachedGames(n),this.updateVisibleGames()),this.isLoading=!1,this.error=null}catch(e){console.error("Error fetching games:",e),this.games.length||(this.error="Error loading games"),this.isLoading=!1}}getCachedGames(){try{const e=localStorage.getItem(this.CACHE_KEY);return e?JSON.parse(e):null}catch(e){return console.error("Error retrieving cached games:",e),null}}setCachedGames(e){try{localStorage.setItem(this.CACHE_KEY,JSON.stringify(e))}catch(e){console.error("Error saving to localStorage:",e)}}handleSearch(e){this.searchTerm=e.target.value,this.isDropdownVisible=!0,this.loadedCount=0,this.updateVisibleGames()}launchGame(e,n){try{window.TMA&&"function"==typeof window.TMA.navigate?(window.TMA.navigate("GAME",{gameStudio:e.toLowerCase(),gameSlug:n}),console.log("Navigating to game:",{gameStudio:e.toLowerCase(),gameSlug:n})):console.warn("TMA.navigate is not available, falling back to URL redirect"),this.isDropdownVisible=!1,this.clearDropdownContent()}catch(e){console.error("Error launching game:",e)}}updateVisibleGames(){this.visibleGames=this.games.filter((e=>e.name.toLowerCase().includes(this.searchTerm.toLowerCase()))),this.loadedCount=Math.min(this.batchSize,this.visibleGames.length),this.renderedGames=this.visibleGames.slice(0,this.loadedCount),this.setupInfiniteScroll()}setupInfiniteScroll(){const e=this.shadowRoot.querySelector(".sentinel");e&&(this.scrollObserver&&this.scrollObserver.disconnect(),!(this.loadedCount>=this.visibleGames.length)&&(this.scrollObserver=new IntersectionObserver((e=>{e[0].isIntersecting&&this.loadMoreGames()}),{root:this.shadowRoot.querySelector(".dropdown"),rootMargin:"50px"}),this.scrollObserver.observe(e)))}loadMoreGames(){this.loadedCount>=this.visibleGames.length?this.scrollObserver&&(this.scrollObserver.disconnect(),this.scrollObserver=null):(this.loadedCount=Math.min(this.loadedCount+this.batchSize,this.visibleGames.length),this.renderedGames=this.visibleGames.slice(0,this.loadedCount),this.requestUpdate())}updated(e){(e.has("renderedGames")||e.has("searchTerm"))&&this.setupInfiniteScroll()}render(){return a(g||(g=i(['\n    <div class="search-input-icon"></div>\n      <input\n        class="search-input"\n        type="text"\n        placeholder=',"\n        .value=","\n        @focus=","\n        @blur=","\n        @input=",'\n      >\n      <div class="dropdown ','">\n        ',"\n        ","\n      </div>\n    "])),this.placeholders[this.locale]||this.placeholders.en,this.searchTerm,this.handleInputFocus,this.handleInputBlur,this.handleSearch,this.isDropdownVisible?"visible":"",this.isLoading&&!this.games.length?a(l||(l=i(['\n              <div class="loading">\n                <div class="spinner"></div>\n              </div>\n            ']))):this.error?a(d||(d=i(['\n                <div class="error">',"</div>\n              "])),this.error):0===this.visibleGames.length?a(c||(c=i(['\n                  <div style="display: inline-flex; width: 100%; justify-content:center; align-items: end;    transform: translate(0px, 30px);"><img width="32px" height="32px" src="https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/298a2099-37a5-41a0-83cb-c4a3f8e3dfee/footer-search.svg" loading="lazy" style="fill: red" alt="Search Icon"></div>\n                  <p class="no-games" style="color: #cacaca">No games found</p>\n                ']))):this.renderedGames.map((e=>{const n=e.studio.replace(/_/g,"-").toLowerCase(),t="https://game-assets-tma1-prd.themill.tech/cdn-cgi/image/f=avif,f=auto,w=512,h=288/tm/".concat(n,"/").concat(e.slug,"-1024x576?dpr=1&auto=format&fit=max");return a(h||(h=i(['\n                    <div\n                      class="game-item"\n                      @click=',"\n                    >\n                      <img\n                        src=","\n                        alt=",'\n                        loading="lazy"\n                      >\n                      <div class="game-info">\n                        <div class="studio-name">','</div>\n                        <div class="game-name">',"</div>\n                      </div>\n                    </div>\n                  "])),(()=>this.launchGame(e.studio,e.slug)),t,e.name,e.studio.replace(/_/g," "),e.name)})),this.renderedGames.length>0&&this.loadedCount<this.visibleGames.length?a(p||(p=i(['<div class="sentinel"></div>']))):"")}});export{y as __vite_legacy_guard};