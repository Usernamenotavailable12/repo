var S=Object.freeze,_=Object.defineProperty;var J=(l,e,t)=>e in l?_(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var y=(l,e,t)=>J(l,typeof e!="symbol"?e+"":e,t);var c=(l,e)=>S(_(l,"raw",{value:S(e||l.slice())}));function H(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}const{LitElement:P,html:d,css:X}=window.Lit;var N,F,B,V,M,j,T,z,U,G,q,D,L,R;class x extends P{constructor(){super(),this.items=[],this.selectedOptions={},this.loading=!1,this.errorMessages={},this.locale="en",this.shopItemCategoryId="",this.dropdownOpen={},this.fetchError=null,this.translations={en:{buy:"Exchange for",notEnoughCoins:"Not enough coins",betValue:"Select",amount:"Amount",loggIn:"Log in",FreespinAmount:"Number of freespins",FreespinValue:"Freespin value",fetchError:"Connection error",unknownItem:"Unknown item"},ka:{buy:"გადაცვლა",notEnoughCoins:"არასაკმარისი მონეტა",betValue:"არჩევა",amount:"რაოდენობა",loggIn:"შესვლა",FreespinAmount:"სპინების რაოდენობა",FreespinValue:"სპინის ღირებულება",fetchError:"კავშირის პრობლემა",unknownItem:"უცნობი ნივთი"},ru:{buy:"Купить",notEnoughCoins:"Недостаточно монет",betValue:"Выбрать",amount:"Количество",loggIn:"Войти",FreespinAmount:"Количество фриспинов",FreespinValue:"Стоимость фриспина",fetchError:"Не удалось загрузить элементы",unknownItem:"Неизвестный элемент"},tr:{buy:"Satın Al",notEnoughCoins:"Yetersiz Jeton",betValue:"Bahis Değeri",amount:"Miktar",loggIn:"Giriş Yap",FreespinAmount:"Freespin Miktar",FreespinValue:"Freespin Değer",fetchError:"Öğeler yüklenemedi",unknownItem:"Bilinmeyen Öğe"}}}connectedCallback(){super.connectedCallback(),this.shopItemCategoryId&&(this.loadFromCache(),this.fetchItems())}attributeChangedCallback(e,t,s){super.attributeChangedCallback(e,t,s),e==="shopItemCategoryId"&&t!==s&&s&&(this.loadFromCache(),this.fetchItems())}loadFromCache(){const e="shopCache-".concat(this.shopItemCategoryId),t=localStorage.getItem(e);if(t)try{this.items=JSON.parse(t),this.requestUpdate()}catch(s){console.error("Failed to parse cached shop data",s)}}saveToCache(e){const t="shopCache-".concat(this.shopItemCategoryId);try{localStorage.setItem(t,JSON.stringify(e))}catch(s){console.error("Failed to cache shop data",s)}}async fetchItems(){var t,s;this.loading=!0,this.fetchError=null;const e='query ShopItemConnection {\n      shopItemConnection(\n        shopItemCategoryId: "'.concat(this.shopItemCategoryId,'",\n        orderBy: [\n          {\n            field: order,\n            direction: ASCENDING\n          }\n        ],\n        status: ACTIVE\n      ) {\n        edges {\n          node {\n            price { value }\n            id\n            actions {\n              ... on GiveBonusAction {\n                bonus {\n                  reward {\n                    __typename\n                    ... on FreespinsBonusReward {\n                      amount\n                      games { slug studio }\n                      betValue { value }\n                    }\n                    ... on FixedBonusReward {\n                      amounts {\n                        value\n                      }\n                    }\n                  }\n                }\n              }\n              ... on GiveAndActivateBonusAction {\n                bonus {\n                  reward {\n                    __typename\n                    ... on FreespinsBonusReward {\n                      amount\n                      games { slug studio }\n                      betValue { value }\n                    }\n                    ... on FixedBonusReward {\n                      amounts {\n                        value\n                      }\n                    }\n                  }\n                }\n              }\n              ... on GiveBoxAction {\n                box {\n                  description\n                  type\n                }\n              }\n              __typename\n            }\n          }\n        }\n      }\n    }');try{const o=await(await fetch("https://www.ambassadoribet.com/_internal/gql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})})).json();if(o.errors)throw new Error(o.errors[0].message);if(!((s=(t=o.data)==null?void 0:t.shopItemConnection)!=null&&s.edges))throw new Error("Invalid response");const a=this.groupItemsBySlug(o.data.shopItemConnection.edges);a.length?(this.saveToCache(a),this.items=a):(this.fetchError=this.translations[this.locale].fetchError,this.items=[])}catch(n){console.error("Fetch error:",n.message),this.fetchError=this.translations[this.locale].fetchError,this.items.length||(this.items=[])}finally{this.loading=!1,this.requestUpdate()}}groupItemsBySlug(e){const t={};return e.forEach(({node:s},n)=>{var p,h,u,m,b,f,r,g,v,I,k,$,C,A,O;const o=(p=s.actions)==null?void 0:p[0];if(!o){console.warn("No actions found for node at index ".concat(n));return}let a,i;if((o.__typename==="GiveBonusAction"||o.__typename==="GiveAndActivateBonusAction")&&((u=(h=o.bonus)==null?void 0:h.reward)==null?void 0:u.__typename)==="FreespinsBonusReward"){const{slug:w,studio:E}=((m=o.bonus.reward.games)==null?void 0:m[0])||{};if(!w||!E){console.warn("Missing slug or studio for freespins item at index ".concat(n));return}a=w,t[a]||(t[a]={type:"freespins",slug:w,studio:E,items:[],betValues:new Set,amounts:new Set}),i={id:s.id,price:((b=s.price)==null?void 0:b.value)||0,betValue:((f=o.bonus.reward.betValue)==null?void 0:f.value)||0,amount:o.bonus.reward.amount||0},t[a].betValues.add(i.betValue),t[a].amounts.add(i.amount)}else(o.__typename==="GiveBonusAction"||o.__typename==="GiveAndActivateBonusAction")&&((g=(r=o.bonus)==null?void 0:r.reward)==null?void 0:g.__typename)==="FixedBonusReward"?(a="fixed-".concat(s.id,"-").concat(n),i={type:"fixed",id:s.id,price:((v=s.price)==null?void 0:v.value)||0,amount:((k=(I=o.bonus.reward.amounts)==null?void 0:I[0])==null?void 0:k.value)||0}):o.__typename==="GiveBoxAction"?(a="box-".concat(s.id,"-").concat(n),i={type:"box",id:s.id,price:(($=s.price)==null?void 0:$.value)||0,boxType:((C=o.box)==null?void 0:C.type)||"UNKNOWN",description:((A=o.box)==null?void 0:A.description)||"No description"}):(a="unknown-".concat(s.id,"-").concat(n),i={type:"unknown",id:s.id,price:((O=s.price)==null?void 0:O.value)||0,description:"Unknown Item"});a&&i&&(t[a]||(t[a]={type:i.type,items:[],...i.type==="freespins"?{betValues:new Set,amounts:new Set}:{}}),t[a].items.push(i))}),Object.values(t)}async purchaseItem(e,t){this.loading=!0,this.errorMessages={...this.errorMessages,[t]:""},this.requestUpdate();const s="mutation PurchaseShopItems($input: PurchaseShopItemsInput!) {\n      purchaseShopItems(input: $input) {\n        shopTransaction {\n          userId\n          shopItems { id }\n        }\n      }\n    }";try{const n=extractAuthDataFromCookie();if(!n||!n.accessToken)throw TMA.execute("LOGIN_CONNECTED"),new Error("Unable to retrieve authorization data.");const a=await(await fetch("https://www.ambassadoribet.com/_internal/gql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n.accessToken)},body:JSON.stringify({query:s,variables:{input:{shopItemIds:[e]}}})})).json();if(a.errors)a.errors[0].message==="NOT_ENOUGH_MONEY"?this.errorMessages={...this.errorMessages,[t]:this.translations[this.locale].notEnoughCoins}:a.errors[0].message==="FORBIDDEN"?(TMA.execute("LOGIN_CONNECTED"),this.errorMessages={...this.errorMessages,[t]:this.translations[this.locale].loggIn}):this.errorMessages={...this.errorMessages,[t]:"Purchase failed"},setTimeout(()=>{this.errorMessages={},this.requestUpdate()},1e3);else if(a.data.purchaseShopItems){const i=this.shadowRoot.querySelector("#buy-".concat(t));i&&(i.classList.add("success"),setTimeout(()=>{i.classList.remove("success")},3e3))}}catch(n){this.errorMessages={...this.errorMessages,[t]:this.translations[this.locale].loggIn},setTimeout(()=>{this.errorMessages={},this.requestUpdate()},1e3)}finally{this.loading=!1,this.requestUpdate()}}handleFilterChange(e,t,s){this.selectedOptions={...this.selectedOptions,[e]:{...this.selectedOptions[e],[t]:s}},this.dropdownOpen={...this.dropdownOpen,[e]:!1},this.requestUpdate()}toggleDropdown(e){const t={};Object.keys(this.dropdownOpen).forEach(s=>{t[s]=!1}),t[e]=!this.dropdownOpen[e],this.dropdownOpen=t,this.requestUpdate()}getSelectedItem(e){var o,a;if(e.type!=="freespins")return e.items[0];const t=this.selectedOptions[e.slug]||{},s=t.betValue||(((o=e.betValues)==null?void 0:o.size)>0?[...e.betValues][0]:0),n=t.amount||(((a=e.amounts)==null?void 0:a.size)>0?[...e.amounts][0]:0);return e.items.find(i=>i.betValue===s&&i.amount===Number(n))||e.items[0]}render(){return this.fetchError?d(F||(F=c(['<div class="error-card">',"</div>"])),this.fetchError):!this.items.length&&!this.loading?d(B||(B=c(['<div class="error-card">No items available</div>']))):d(R||(R=c(['\n      <div class="shop-container">\n        ',"\n      </div>\n    "])),this.items.map(e=>{var t,s,n,o,a,i,p,h,u,m,b,f;return d(L||(L=c(['\n            <div class="card">\n              ','\n              <button\n                id="buy-','"\n                class="buy-button"\n                ?disabled="','"\n                @click="','"\n              >\n                ',"\n                ","\n              </button>\n              ","\n            </div>\n          "])),e.type==="freespins"?d(z||(z=c(['\n                    <img\n                      src="https://game-assets-tma1-prd.themill.tech/cdn-cgi/image/f=avif,f=auto,w=412,h=188/tm/',"/",'-1024x576?dpr=1&auto=format&fit=max"\n                      alt="','"\n                    />\n                    <div class="card-content">\n                      <h3\n                        style="margin-block: .8rem; color: rgba(255, 255, 255, 1); font-family: \'Noto Sans Ambassadori Bold\'; text-align: center;"\n                      >\n                        ','\n                      </h3>\n                      <div class="filters">\n                        ','\n                        <span class="FreespinValue"\n                          >','</span\n                        >\n                        <div class="custom-dropdown">\n                          <div\n                            class="dropdown-button"\n                            @click="','"\n                          >\n                            <span>\n                              ',"\n                            </span>\n                            <span>▼</span>\n                          </div>\n                          ","\n                        </div>\n                      </div>\n                    </div>\n                  "])),(t=e.studio)==null?void 0:t.toLowerCase().replace(/_/g,"-"),e.slug,e.slug||"Game",((s=e.slug)==null?void 0:s.replace(/-/g," ").replace(/\b\w/g,r=>r.toUpperCase()))||"Unknown Game",e.amounts&&e.amounts.size>0?d(M||(M=c(['\n                              <span class="FreespinAmount"\n                                >','</span\n                              >\n                              <div\n                                @change="','"\n                              >\n                                ',"\n                              </div>\n                            "])),this.translations[this.locale].FreespinAmount,r=>this.handleFilterChange(e.slug,"amount",r.target.value),[...e.amounts].map(r=>{var g;return d(V||(V=c(['\n                                    <input\n                                      style="display: none;"\n                                      id="',"-",'"\n                                      type="radio"\n                                      name="amount-','"\n                                      value="','"\n                                      ?checked="','"\n                                    />\n                                    <label\n                                      class="amount-selector"\n                                      for="',"-",'"\n                                    >\n                                      ',"\n                                    </label>\n                                  "])),e.slug,r,e.slug,r,((g=this.selectedOptions[e.slug])==null?void 0:g.amount)===r,e.slug,r,r)})):"",this.translations[this.locale].FreespinValue,()=>this.toggleDropdown(e.slug),((n=this.selectedOptions[e.slug])==null?void 0:n.betValue)||this.translations[this.locale].betValue,this.dropdownOpen[e.slug]?d(T||(T=c(['\n                                <div class="dropdown-list">\n                                  ',"\n                                </div>\n                              "])),[...e.betValues||[]].map(r=>d(j||(j=c(['\n                                      <div\n                                        class="dropdown-item"\n                                        @click="','"\n                                      >\n                                        '," ₾\n                                      </div>\n                                    "])),()=>this.handleFilterChange(e.slug,"betValue",r),r))):""):e.type==="fixed"?d(U||(U=c(['\n                    <div class="reward-container fixed-bonus">\n                      ',' ₾\n                    </div>\n                    <div class="card-content"></div>\n                  '])),((o=e.items[0])==null?void 0:o.amount)||0):e.type==="box"?d(G||(G=c(['\n                    <div\n                      class="reward-container ','"\n                    ></div>\n                    <div class="card-content">\n                      <h3\n                        style="margin-block: .8rem; color: rgba(255, 255, 255, 1); font-family: \'Noto Sans Ambassadori Bold\'; text-align: center;"\n                      >\n                        ',"\n                      </h3>\n                    </div>\n                  "])),((i=(a=e.items[0])==null?void 0:a.boxType)==null?void 0:i.toLowerCase().replace(/_/g,"-"))||"unknown",((p=e.items[0])==null?void 0:p.description)||"No description"):d(q||(q=c(['\n                    <div class="reward-container unknown">\n                      ','\n                    </div>\n                    <div class="card-content"></div>\n                  '])),((h=e.items[0])==null?void 0:h.description)||"Unknown Item"),e.type==="freespins"?e.slug:(u=e.items[0])==null?void 0:u.id,this.loading||!this.getSelectedItem(e),()=>{const r=this.getSelectedItem(e);r&&this.purchaseItem(r.id,e.type==="freespins"?e.slug:e.items[0].id)},this.translations[this.locale].buy,((m=this.getSelectedItem(e))==null?void 0:m.price)||"N/A",this.errorMessages[e.type==="freespins"?e.slug:(b=e.items[0])==null?void 0:b.id]?d(D||(D=c(['\n                    <div class="error-text">\n                      ',"\n                    </div>\n                  "])),this.errorMessages[e.type==="freespins"?e.slug:(f=e.items[0])==null?void 0:f.id]):"")}))}}y(x,"styles",X(N||(N=c(['\n    :host {\n      display: block;\n      padding: 16px;\n    }\n    .shop-container {\n      display: grid;\n      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n      gap: 16px;\n    }\n    @media (max-width: 1200px) {\n      .shop-container {\n        grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));\n      }\n    }\n    .card {\n      border-radius: 12px;\n      overflow: hidden;\n      background: #3d0235c7;\n      backdrop-filter: blur(10px);\n      -webkit-backdrop-filter: blur(10px);\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n      padding: 10px;\n    }\n    .card img {\n      width: 100%;\n      height: auto;\n      object-fit: cover;\n      border-radius: 8px;\n    }\n    .card-content {\n      padding: 0px 6px 6px 6px;\n    }\n    .filters {\n      margin-bottom: 16px;\n      display: flex;\n      gap: 8px;\n      flex-wrap: wrap;\n      justify-content: center;\n      width: 100%;\n      flex-direction: column;\n      > div {\n        gap: 8px;\n        display: flex;\n        flex-wrap: wrap;\n        flex: 1 1 0;\n      }\n      .amount-selector {\n        color: white;\n        padding: 10px;\n        border-radius: 8px;\n        background-color: rgba(38, 40, 61, 1);\n        opacity: 0.5;\n        flex: 1;\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        text-align: center;\n        cursor: pointer;\n      }\n    }\n    input:checked + .amount-selector {\n      background-color: rgba(38, 40, 61, 1);\n      opacity: 1;\n    }\n    .custom-dropdown {\n      position: relative;\n      width: 100%;\n      .dropdown-button {\n        padding: 8px 12px;\n        border-radius: 14px;\n        font-family: "Noto Sans Ambassadori";\n        color: white;\n        background: #26283d;\n        border: 2px solid rgba(71, 47, 80, 1);\n        cursor: pointer;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        flex: 1;\n      }\n    }\n    .dropdown-list {\n      position: absolute;\n      bottom: 100%;\n      left: 0;\n      right: 0;\n      background: #26283dbe;\n      border-radius: 8px;\n      border: 2px solid rgba(71, 47, 80, 1);\n      backdrop-filter: blur(10px);\n      -webkit-backdrop-filter: blur(10px);\n      margin-top: 4px;\n      z-index: 10;\n      max-height: 200px;\n      overflow-y: auto;\n    }\n    .dropdown-item {\n      padding: 8px;\n      color: white;\n      cursor: pointer;\n      font-family: "Noto Sans Ambassadori";\n    }\n    .dropdown-item:hover {\n      background: #cf167d;\n    }\n    .buy-button {\n      width: 100%;\n      padding: 5px;\n      border: solid 2px rgba(207, 22, 125, 1);\n      border-radius: 64px;\n      background: linear-gradient(\n        135deg,\n        rgba(223, 4, 150, 0.77),\n        rgba(14, 4, 74, 0.77)\n      );\n      background-size: 200% 200%;\n      color: white;\n      cursor: pointer;\n      font-size: 16px;\n      font-family: "Noto Sans Ambassadori";\n      transition: background-position 0.6s ease;\n    }\n    .buy-button:hover {\n      background-position: 100% 100%;\n    }\n    .buy-button:disabled {\n      background: #ccc;\n      cursor: not-allowed;\n    }\n    .buy-button.success {\n      background: #28a745;\n    }\n    .error-text {\n      color: red;\n      font-size: 12px;\n      margin-top: 4px;\n      text-align: center;\n      font-family: "Noto Sans Ambassadori";\n    }\n    .FreespinValue,\n    .FreespinAmount {\n      color: rgba(255, 255, 255, 0.77);\n      font-size: 12px;\n      font-family: "Noto Sans Ambassadori";\n    }\n    .reward-container {\n      width: 100%;\n      height: 144px;\n      border-radius: 8px;\n      position: relative;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: white;\n      font-family: "Noto Sans Ambassadori";\n      font-size: 24px;\n      font-weight: bold;\n      text-align: center;\n    }\n    .fixed-bonus {\n      background: url("https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/da9ff7ef-381b-4927-9d2f-8cf73410f47b/dad.png")\n      center / cover no-repeat;\n      font-size: 34px;\n      text-shadow: 1px 1px 2px red, 0 0 1em gold, 0 0 0.2em gold;\n    }\n    .loot-box {\n      background: url("https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/bc1b3327-fccc-4c28-a3cd-a23cfa102888/BOX-5.jpg?auto=format%2Ccompress")\n        center/cover no-repeat;\n      font-size: 14px;\n      align-items: start;\n      justify-content: start;\n    }\n    .mystery-box {\n      background: url("https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/bc1b3327-fccc-4c28-a3cd-a23cfa102888/BOX-5.jpg?auto=format%2Ccompress")\n        center/cover no-repeat;\n      font-size: 14px;\n      align-items: start;\n      justify-content: start;\n    }\n    .wheel-of-fortune {\n      background: url("https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/431be0d0-483d-413c-9ea0-bf13045890fa/WHEEL-1.jpg?auto=format%2Ccompress")\n        center/cover no-repeat;\n      font-size: 14px;\n      align-items: start;\n      justify-content: start;\n    }\n    .unknown {\n      background: url("https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/bc1b3327-fccc-4c28-a3cd-a23cfa102888/BOX-5.jpg?auto=format%2Ccompress")\n        center/cover no-repeat;\n      font-size: 14px;\n      align-items: start;\n      justify-content: start;\n    }\n    .error-card {\n      color: red;\n      text-align: center;\n      padding: 20px;\n    }\n  '])))),y(x,"properties",{items:{type:Array},selectedOptions:{type:Object},loading:{type:Boolean},errorMessages:{type:Object},locale:{type:String},shopItemCategoryId:{type:String,attribute:!0},dropdownOpen:{type:Object},fetchError:{type:String}});customElements.define("shop-component",x);export{H as __vite_legacy_guard};
//# sourceMappingURL=shop-2.js.map
