var u=Object.freeze,h=Object.defineProperty;var v=(a,e,t)=>e in a?h(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var c=(a,e,t)=>v(a,typeof e!="symbol"?e+"":e,t);var i=(a,e)=>u(h(a,"raw",{value:u(e||a.slice())}));function V(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}const{LitElement:I,html:d,css:$}=window.Lit;var m,b,g,f,w,x,y;class p extends I{constructor(){super(),this.items=[],this.selectedOptions={},this.loading=!1,this.errorMessages={},this.locale="en",this.shopItemCategoryId="",this.dropdownOpen={},this.translations={en:{buy:"Buy",notEnoughCoins:"Not Enough Coins",betValue:"Bet Value",amount:"Amount",loggIn:"Log In",FreespinAmount:"Freespin Amount",FreespinValue:"Freespin Value"},ka:{buy:"ყიდვა",notEnoughCoins:"არასაკმარისი მონეტები",betValue:"ნომინალი",amount:"რაოდენობა",loggIn:"შესვლა",FreespinAmount:"Freespin Amount",FreespinValue:"Freespin Value"},ru:{buy:"Купить",notEnoughCoins:"Недостаточно монет",betValue:"Значение ставки",amount:"Количество",loggIn:"Войти",FreespinAmount:"Freespin Amount",FreespinValue:"Freespin Value"},tr:{buy:"Satın Al",notEnoughCoins:"Yetersiz Jeton",betValue:"Bahis Değeri",amount:"Miktar",loggIn:"Giriş Yap",FreespinAmount:"Freespin Amount",FreespinValue:"Freespin Value"}}}connectedCallback(){super.connectedCallback(),this.shopItemCategoryId&&this.fetchItems()}async fetchItems(){const e='query ShopItemConnection {\n      shopItemConnection(\n        shopItemCategoryId: "'.concat(this.shopItemCategoryId,'",\n        orderBy: [\n          {\n            field: order,\n            direction: ASCENDING\n          }\n        ],\n        status: ACTIVE\n      ) {\n        edges {\n          node {\n            price { value }\n            id\n            actions {\n              ... on GiveBonusAction {\n                bonus {\n                  reward {\n                    ... on FreespinsBonusReward {\n                      amount\n                      games { slug studio }\n                      betValue { value }\n                    }\n                  }\n                }\n              }\n              ... on GiveAndActivateBonusAction {\n                bonus {\n                  reward {\n                    ... on FreespinsBonusReward {\n                      amount\n                      games { slug studio }\n                      betValue { value }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }');try{const o=await(await fetch("https://www.ambassadoribet.com/_internal/gql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})})).json();this.items=this.groupItemsBySlug(o.data.shopItemConnection.edges)}catch(t){console.error("Error fetching items:",t)}}groupItemsBySlug(e){const t={};return e.forEach(({node:o})=>{const s=o.actions[0];if(s&&s.bonus&&s.bonus.reward){const{slug:r,studio:l}=s.bonus.reward.games[0],n=r;t[n]||(t[n]={slug:r,studio:l,items:[],betValues:new Set,amounts:new Set}),t[n].items.push({id:o.id,price:o.price.value,betValue:s.bonus.reward.betValue.value,amount:s.bonus.reward.amount}),t[n].betValues.add(s.bonus.reward.betValue.value),t[n].amounts.add(s.bonus.reward.amount)}}),Object.values(t)}async purchaseItem(e,t){this.loading=!0,this.errorMessages={...this.errorMessages,[t]:""},this.requestUpdate();const o="mutation PurchaseShopItems($input: PurchaseShopItemsInput!) {\n      purchaseShopItems(input: $input) {\n        shopTransaction {\n          userId\n          shopItems { id }\n        }\n      }\n    }";try{const s=extractAuthDataFromCookie();if(!s||!s.accessToken)throw this.errorMessages={...this.errorMessages,[t]:this.translations[this.locale].loggIn},new Error("Unable to retrieve authorization data.");const l=await(await fetch("https://www.ambassadoribet.com/_internal/gql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s.accessToken)},body:JSON.stringify({query:o,variables:{input:{shopItemIds:[e]}}})})).json();if(l.errors)l.errors[0].message==="NOT_ENOUGH_MONEY"?this.errorMessages={...this.errorMessages,[t]:this.translations[this.locale].notEnoughCoins}:l.errors[0].message==="FORBIDDEN"&&TMA.execute("LOGIN_CONNECTED");else if(l.data.purchaseShopItems){const n=this.shadowRoot.querySelector("#buy-".concat(t));n.classList.add("success"),setTimeout(()=>{n.classList.remove("success")},3e3)}}catch(s){console.error("Purchase error:",s),this.errorMessages={...this.errorMessages,[t]:this.translations[this.locale].loggIn}}finally{this.loading=!1,this.requestUpdate()}}handleFilterChange(e,t,o){this.selectedOptions={...this.selectedOptions,[e]:{...this.selectedOptions[e],[t]:o}},this.dropdownOpen={...this.dropdownOpen,[e]:!1}}toggleDropdown(e){const t={};Object.keys(this.dropdownOpen).forEach(o=>{t[o]=!1}),t[e]=!this.dropdownOpen[e],this.dropdownOpen=t}getSelectedItem(e){const t=this.selectedOptions[e.slug]||{},o=t.betValue||[...e.betValues][0],s=t.amount||[...e.amounts][0];return e.items.find(r=>r.betValue===o&&r.amount===Number(s))}render(){return d(y||(y=i(['\n      <div class="shop-container">\n        ',"\n      </div>\n    "])),this.items.map(e=>{var t,o;return d(x||(x=i(['\n            <div class="card">\n              <img\n                src="https://game-assets-tma1-prd.themill.tech/cdn-cgi/image/f=avif,f=auto,w=512,h=288/tm/',"/",'-1024x576?dpr=1&auto=format&fit=max"\n                alt="','"\n              />\n              <div class="card-content">\n                <h3\n                  style="margin-block: .8rem; color: rgba(255, 255, 255, 1); font-family: \'Noto Sans Ambassadori Bold\'; text-align: center;"\n                >\n                  ','\n                </h3>\n                <div class="filters">\n                <span class="FreespinAmount">','</span>\n                  <div\n                    @change="','"\n                  >\n                    ','\n                  </div>\n                  <span class="FreespinValue">','</span>\n                  <div class="custom-dropdown">\n                    <div\n                      class="dropdown-button"\n                      @click="','"\n                    >\n                      <span>\n                        ',"\n                      </span>\n                      <span>▼</span>\n                    </div>\n                    ",'\n                  </div>\n                </div>\n                <button\n                  id="buy-','"\n                  class="buy-button"\n                  ?disabled="','"\n                  @click="','"\n                >\n                  ',"\n                  ","\n                </button>\n                ","\n              </div>\n            </div>\n          "])),e.studio.toLowerCase().replace(/_/g,"-"),e.slug,e.slug,e.slug.replace(/-/g," ").replace(/\b\w/g,s=>s.toUpperCase()),this.translations[this.locale].FreespinAmount,s=>this.handleFilterChange(e.slug,"amount",s.target.value),[...e.amounts].map(s=>d(b||(b=i(['\n                        <input\n                          style="display: none;"\n                          id="',"-",'"\n                          type="radio"\n                          name="amount-','"\n                          value="','"\n                        />\n                        <label\n                          class="amount-selector"\n                          for="',"-",'"\n                        >\n                          ',"\n                        </label>\n                      "])),e.slug,s,e.slug,s,e.slug,s,s)),this.translations[this.locale].FreespinValue,()=>this.toggleDropdown(e.slug),((t=this.selectedOptions[e.slug])==null?void 0:t.betValue)||this.translations[this.locale].betValue,this.dropdownOpen[e.slug]?d(f||(f=i(['\n                          <div class="dropdown-list">\n                            ',"\n                          </div>\n                        "])),[...e.betValues].map(s=>d(g||(g=i(['\n                                <div\n                                  class="dropdown-item"\n                                  @click="','"\n                                >\n                                  '," ₾\n                                </div>\n                              "])),()=>this.handleFilterChange(e.slug,"betValue",s),s))):"",e.slug,this.loading,()=>{const s=this.getSelectedItem(e);s&&this.purchaseItem(s.id,e.slug)},this.translations[this.locale].buy,((o=this.getSelectedItem(e))==null?void 0:o.price)||"",this.errorMessages[e.slug]?d(w||(w=i(['\n                      <div class="error-text">\n                        ',"\n                      </div>\n                    "])),this.errorMessages[e.slug]):"")}))}}c(p,"styles",$(m||(m=i(['\n    :host {\n      display: block;\n      padding: 16px;\n    }\n    .shop-container {\n      display: grid;\n      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n      gap: 16px;\n    }\n    @media (max-width: 1200px) {\n      .shop-container {\n        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));\n      }\n    }\n    .card {\n      border-radius: 8px;\n      overflow: hidden;\n      background: #3d0235c7;\n      backdrop-filter: blur(10px);\n      -webkit-backdrop-filter: blur(10px);\n      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);\n      padding: 10px;\n      border: 2px solid rgba(71, 47, 80, 1);\n    }\n    .card img {\n      width: 100%;\n      height: 144px;\n      object-fit: cover;\n      border-radius: 8px;\n    }\n    .card-content {\n      padding: 0px 6px 6px 6px;\n    }\n    .filters {\n      margin-bottom: 16px;\n      display: flex;\n      gap: 8px;\n      flex-wrap: wrap;\n      justify-content: center;\n      width: 100%;\n      flex-direction: column;\n      > div {\n        gap: 8px;\n        display: flex;\n        flex-wrap: wrap;\n        flex: 1 1 0;\n      }\n      .amount-selector {\n        color: white;\n        padding: 10px;\n        border-radius: 8px;\n        background-color: rgba(38, 40, 61, 1);\n        opacity: 0.5;\n        flex: 1;\n        border: 1px solid rgba(255, 255, 255, 0.2);\n        text-align: center;\n        cursor: pointer;\n      }\n    }\n    input:checked + .amount-selector {\n      background-color: rgba(38, 40, 61, 1);\n      opacity: 1;\n    }\n    .custom-dropdown {\n      position: relative;\n      width: 100%;\n      .dropdown-button {\n      padding: 8px 12px;\n      border-radius: 14px;\n      font-family: "Noto Sans Ambassadori";\n      color: white;\n      background: #26283D;\n      border: 2px solid rgba(71, 47, 80, 1);\n      cursor: pointer;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      flex: 1;\n    }\n    }\n    .dropdown-list {\n      position: absolute;\n      bottom: 100%;\n      left: 0;\n      right: 0;\n      background: #26283dbe;\n      border-radius: 8px;\n      border: 2px solid rgba(71, 47, 80, 1);\n      backdrop-filter: blur(10px);\n      -webkit-backdrop-filter: blur(10px);\n      margin-top: 4px;\n      z-index: 10;\n      max-height: 200px;\n      overflow-y: auto;\n    }\n    .dropdown-item {\n      padding: 8px;\n      color: white;\n      cursor: pointer;\n      font-family: "Noto Sans Ambassadori";\n    }\n    .dropdown-item:hover {\n      background: #CF167D;\n    }\n    .buy-button {\n      width: 100%;\n      padding: 5px;\n      border: solid 2px rgba(207, 22, 125, 1);\n      border-radius: 64px;\n      background: linear-gradient(\n        135deg,\n        rgba(223, 4, 150, 0.77),\n        rgba(14, 4, 74, 0.77)\n      );\n      background-size: 200% 200%;\n      color: white;\n      cursor: pointer;\n      font-size: 16px;\n      font-family: "Noto Sans Ambassadori";\n      transition: background-position 0.6s ease;\n    }\n    .buy-button:hover {\n      background-position: 100% 100%;\n    }\n    .buy-button:disabled {\n      background: #ccc;\n      cursor: not-allowed;\n    }\n    .buy-button.success {\n      background: #28a745;\n    }\n    .error-text {\n      color: red;\n      font-size: 12px;\n      margin-top: 4px;\n      text-align: center;\n      font-family: "Noto Sans Ambassadori";\n    }\n    .FreespinValue,\n    .FreespinAmount {\n      color: rgba(255, 255, 255, 0.77);\n      font-size: 12px;\n      font-family: "Noto Sans Ambassadori";\n    }\n  '])))),c(p,"properties",{items:{type:Array},selectedOptions:{type:Object},loading:{type:Boolean},errorMessages:{type:Object},locale:{type:String},shopItemCategoryId:{type:String,attribute:!0},dropdownOpen:{type:Object}});customElements.define("shop-component",p);export{V as __vite_legacy_guard};
//# sourceMappingURL=shop.js.map
