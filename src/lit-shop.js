var h=Object.freeze,p=Object.defineProperty;var I=(o,e,t)=>e in o?p(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var d=(o,e,t)=>I(o,typeof e!="symbol"?e+"":e,t);var i=(o,e)=>h(p(o,"raw",{value:h(e||o.slice())}));function C(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}const{LitElement:v,html:c,css:x}=window.Lit;var m,g,b,f,y,w;class u extends v{constructor(){super(),this.items=[],this.selectedOptions={},this.loading=!1,this.errorMessages={},this.locale="en",this.translations={en:{buy:"Buy",notEnoughCoins:"Not Enough Coins",betValue:"Bet Value",amount:"Amount",loggIn:"Log In"},ka:{buy:"ყიდვა",notEnoughCoins:"არასაკმარისი მონეტები",betValue:"ფსონის მნიშვნელობა",amount:"რაოდენობა",loggIn:"შესვლა"},ru:{buy:"Купить",notEnoughCoins:"Недостаточно монет",betValue:"Значение ставки",amount:"Количество",loggIn:"Войти"},tr:{buy:"Satın Al",notEnoughCoins:"Yetersiz Jeton",betValue:"Bahis Değeri",amount:"Miktar",loggIn:"Giriş Yap"}}}connectedCallback(){super.connectedCallback(),this.fetchItems()}async fetchItems(){const e='query ShopItemConnection {\n      shopItemConnection(\n        shopItemCategoryId: "EaSWdQhNv4QlgYY38yut",\n        orderBy: [\n          {\n            field: order,\n            direction: ASCENDING\n          }\n        ],\n        status: ACTIVE\n      ) {\n        edges {\n          node {\n            price { value }\n            id\n            actions {\n              ... on GiveBonusAction {\n                bonus {\n                  reward {\n                    ... on FreespinsBonusReward {\n                      amount\n                      games { slug studio }\n                      betValue { value }\n                    }\n                  }\n                }\n              }\n              ... on GiveAndActivateBonusAction {\n                bonus {\n                  reward {\n                    ... on FreespinsBonusReward {\n                      amount\n                      games { slug studio }\n                      betValue { value }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }';try{const s=await(await fetch("https://www.ambassadoribet.com/_internal/gql",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:e})})).json();this.items=this.groupItemsBySlug(s.data.shopItemConnection.edges)}catch(t){console.error("Error fetching items:",t)}}groupItemsBySlug(e){const t={};return e.forEach(({node:s})=>{const a=s.actions[0];if(a&&a.bonus&&a.bonus.reward){const{slug:r,studio:l}=a.bonus.reward.games[0],n=r;t[n]||(t[n]={slug:r,studio:l,items:[],betValues:new Set,amounts:new Set}),t[n].items.push({id:s.id,price:s.price.value,betValue:a.bonus.reward.betValue.value,amount:a.bonus.reward.amount}),t[n].betValues.add(a.bonus.reward.betValue.value),t[n].amounts.add(a.bonus.reward.amount)}}),Object.values(t)}async purchaseItem(e,t){this.loading=!0,this.errorMessages={...this.errorMessages,[t]:""},this.requestUpdate();const s="mutation PurchaseShopItems($input: PurchaseShopItemsInput!) {\n      purchaseShopItems(input: $input) {\n        shopTransaction {\n          userId\n          shopItems { id }\n        }\n      }\n    }";try{const a=extractAuthDataFromCookie();if(!a||!a.accessToken)throw this.errorMessages={...this.errorMessages,[t]:this.translations[this.locale].loggIn},new Error("Unable to retrieve authorization data.");const l=await(await fetch("https://www.ambassadoribet.com/_internal/gql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a.accessToken)},body:JSON.stringify({query:s,variables:{input:{shopItemIds:[e]}}})})).json();if(l.errors)l.errors[0].message==="NOT_ENOUGH_MONEY"?this.errorMessages={...this.errorMessages,[t]:this.translations[this.locale].notEnoughCoins}:l.errors[0].message==="FORBIDDEN"&&(this.errorMessages={...this.errorMessages,[t]:this.translations[this.locale].loggIn});else if(l.data.purchaseShopItems){const n=this.shadowRoot.querySelector("#buy-".concat(t));n.classList.add("success"),setTimeout(()=>{n.classList.remove("success")},3e3)}}catch(a){console.error("Purchase error:",a),this.errorMessages={...this.errorMessages,[t]:this.translations[this.locale].loggIn}}finally{this.loading=!1,this.requestUpdate()}}handleFilterChange(e,t,s){this.selectedOptions={...this.selectedOptions,[e]:{...this.selectedOptions[e],[t]:s}}}getSelectedItem(e){const t=this.selectedOptions[e.slug]||{},s=t.betValue||[...e.betValues][0],a=t.amount||[...e.amounts][0];return e.items.find(r=>r.betValue===s&&r.amount===Number(a))}render(){return c(w||(w=i(['\n      <div class="shop-container">\n        ',"\n      </div>\n    "])),this.items.map(e=>{var t;return c(y||(y=i(['\n            <div class="card">\n              <img\n                src="https://game-assets-tma1-prd.themill.tech/cdn-cgi/image/f=avif,f=auto,w=512,h=288/tm/',"/",'-1024x576?dpr=1&auto=format&fit=max"\n                alt="','"\n              />\n              <div class="card-content">\n                <div class="filters">\n                  <select\n                    @change="','"\n                  >\n                    <option value="" disabled selected>',"</option>\n                    ",'\n                  </select>\n                  <select\n                    @change="','"\n                  >\n                    <option value="" disabled selected>',"</option>\n                    ",'\n                  </select>\n                </div>\n                <button\n                  id="buy-','"\n                  class="buy-button"\n                  ?disabled="','"\n                  @click="','"\n                >\n                  '," ","\n                </button>\n                ","\n              </div>\n            </div>\n          "])),e.studio.toLowerCase().replace(/_/g,"-"),e.slug,e.slug,s=>this.handleFilterChange(e.slug,"betValue",s.target.value),this.translations[this.locale].betValue,[...e.betValues].map(s=>c(g||(g=i(['<option value="','">',"</option>"])),s,s)),s=>this.handleFilterChange(e.slug,"amount",s.target.value),this.translations[this.locale].amount,[...e.amounts].map(s=>c(b||(b=i(['<option value="','">',"</option>"])),s,s)),e.slug,this.loading,()=>{const s=this.getSelectedItem(e);s&&this.purchaseItem(s.id,e.slug)},this.translations[this.locale].buy,((t=this.getSelectedItem(e))==null?void 0:t.price)||"",this.errorMessages[e.slug]?c(f||(f=i(['<div class="error-text">',"</div>"])),this.errorMessages[e.slug]):"")}))}}d(u,"styles",x(m||(m=i(["\n    :host {\n      display: block;\n      padding: 16px;\n    }\n    .shop-container {\n      display: grid;\n      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));\n      gap: 16px;\n    }\n    .card {\n      border: 1px solid #ddd;\n      border-radius: 8px;\n      overflow: hidden;\n      background: white;\n      box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n    }\n    .card img {\n      width: 100%;\n      height: 144px;\n      object-fit: cover;\n    }\n    .card-content {\n      padding: 16px;\n    }\n    .filters {\n      margin-bottom: 16px;\n      display: flex;\n      gap: 8px;\n      flex-wrap: wrap;\n    }\n    select {\n      padding: 8px;\n      border-radius: 4px;\n      border: 1px solid #ddd;\n    }\n    .buy-button {\n      width: 100%;\n      padding: 12px;\n      border: none;\n      border-radius: 4px;\n      background: #007bff;\n      color: white;\n      cursor: pointer;\n      font-size: 16px;\n      transition: background 0.3s;\n    }\n    .buy-button:disabled {\n      background: #ccc;\n      cursor: not-allowed;\n    }\n    .buy-button.success {\n      background: #28a745;\n    }\n    .error-text {\n      color: red;\n      font-size: 12px;\n      margin-top: 4px;\n      text-align: center;\n    }\n  "])))),d(u,"properties",{items:{type:Array},selectedOptions:{type:Object},loading:{type:Boolean},errorMessages:{type:Object},locale:{type:String}});customElements.define("shop-component",u);export{C as __vite_legacy_guard};
//# sourceMappingURL=shop.js.map
