var v=Object.freeze,b=Object.defineProperty;var Y=(_,u,t)=>u in _?b(_,u,{enumerable:!0,configurable:!0,writable:!0,value:t}):_[u]=t;var p=(_,u,t)=>Y(_,typeof u!="symbol"?u+"":u,t);var n=(_,u)=>v(b(_,"raw",{value:v(u||_.slice())}));function B(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}const{LitElement:z,html:l,css:R}=window.Lit;var x,y,T,V,k,P,I,E,$,S,M,N,A,X,C,F,L,O,U;class g extends z{constructor(){super();p(this,"_onStageTransitionEnd",t=>{this._transition&&(this._transition=null)});this.locale=document.documentElement.lang||"en",this.slides=[],this._isViewing=!1,this._currentIndex=0,this._isPaused=!1,this._progressMs=0,this._progressFraction=0,this._transition=null,this._loading=!0,this._error=null,this._rafId=null,this._autoTimer=null,this._storyDuration=5e3,this._currentVideoEl=null,this._videoRafId=null,this._onVideoEnded=null,this._viewed=new Set,this._touch={active:!1,startX:0,startY:0,lastX:0,lastY:0,startTime:0,moved:!1},this._stageEl=null,this._touchListenersAttached=!1,this._boundTouchStart=this._onViewerTouchStart.bind(this),this._boundTouchMove=this._onViewerTouchMove.bind(this),this._boundTouchEnd=this._onViewerTouchEnd.bind(this)}connectedCallback(){super.connectedCallback(),window.__storiesLoadedOnce||(sessionStorage.removeItem("stories-carousel-cache"),window.__storiesLoadedOnce=!0),this._fetchStories()}disconnectedCallback(){super.disconnectedCallback(),this._clearTimers(),this._detachStageListeners()}async _fetchStories(){var t,i;this._loading=!0,this._error=null;try{const e=sessionStorage.getItem("stories-carousel-cache");if(e)try{const h=JSON.parse(e);if(Array.isArray(h)){this.slides=h,this._loading=!1;return}}catch(h){}const r="\n      query GetStories($locale: String!) {\n        getStoriesList(locale: $locale, onlyEnabled: true, size: 200) {\n          items {\n            caption\n            sortOrder\n            NavigateVar\n            OptionalHref\n            NavigateParams\n            content { path }\n            thumbnail { path }\n            Georgians\n          }\n        }\n      }\n      ".trim(),s=await fetch("https://api.takeshape.io/project/f2b70d9b-56f9-4d2d-be98-874fcbc02a46/production/graphql",{method:"POST",headers:{"Content-Type":"application/json","X-TakeShape-Token":"d51354712676485f94578c5714b1c466"},body:JSON.stringify({query:r,variables:{locale:this.locale||"en"}})});if(!s.ok)throw new Error("Network error: ".concat(s.status," ").concat(s.statusText));const a=await s.json();if(a.errors)throw new Error("GraphQL errors: ".concat(JSON.stringify(a.errors)));const o=((i=(t=a==null?void 0:a.data)==null?void 0:t.getStoriesList)==null?void 0:i.items)||[];o.sort((h,d)=>{var m,w;const c=Number((m=h==null?void 0:h.sortOrder)!=null?m:0),f=Number((w=d==null?void 0:d.sortOrder)!=null?w:0);return c-f}),this.slides=o;try{sessionStorage.setItem("stories-carousel-cache",JSON.stringify(o))}catch(h){}}catch(e){console.error("Error fetching stories:",e),this._error=String(e)}finally{this._loading=!1}}fixUrl(t){return!t||typeof t!="string"?"":t.replace(/^\//,"")}isVideoPath(t){const i=(t||"").toLowerCase();return/\.(mp4|mov|webm|mkv|avi|wmv)(\?.*)?$/.test(i)}isVideoSlide(t){var i;return this.isVideoPath((i=t==null?void 0:t.content)==null?void 0:i.path)}_fullUrl(t){var e;const i=this.fixUrl(((e=t==null?void 0:t.content)==null?void 0:e.path)||"");return"https://www.ambassadoribet.com/_internal/ts-images/".concat(i,"/?auto=format%2Ccompress")}_thumbUrl(t){var e;const i=this.fixUrl(((e=t==null?void 0:t.thumbnail)==null?void 0:e.path)||"");return"https://www.ambassadoribet.com/_internal/ts-images/".concat(i,"/?auto=format%2Ccompress")}_openViewer(t){var i;(i=this.slides)!=null&&i.length&&(this._isViewing=!0,this._currentIndex=Math.max(0,Math.min(t,this.slides.length-1)),this._markViewed(this._currentIndex),this._transition=null,this._progressMs=0,this._progressFraction=0,this._isPaused=!1,this._startProgress())}_closeViewer(){this._isViewing=!1,this._clearTimers(),this._transition=null,this._progressMs=0,this._progressFraction=0,this._isPaused=!1}_togglePause(){this._isViewing&&(this._isPaused?(this._isPaused=!1,this._startProgress()):(this._isPaused=!0,this._stopProgressKeepPosition()))}_markViewed(t){this._viewed.add(t),this.requestUpdate()}_next(){if(this._isPaused)return;if(this._currentIndex>=this.slides.length-1){this._closeViewer();return}const t=this._currentIndex+1;this._animateTo(t,"right")}_prev(){if(this._isPaused)return;if(this._currentIndex<=0){this._closeViewer();return}const t=this._currentIndex-1;this._animateTo(t,"left")}_animateTo(t,i="right"){const e=this._currentIndex;this._currentIndex=t,this._markViewed(this._currentIndex),this._transition={prevIndex:e,currentIndex:t,direction:i,animating:!0},this._progressMs=0,this._progressFraction=0,this._isPaused=!1,this._startProgress();const r=800;window.clearTimeout(this._cleanupTimer),this._cleanupTimer=window.setTimeout(()=>{this._transition=null},r)}async _startProgress(){var s;this._clearTimers();const t=this.slides[this._currentIndex];if(this.isVideoSlide(t)){await this.updateComplete;const a=(s=this.renderRoot)==null?void 0:s.getElementById("currentVideo");if(!a)return;this._currentVideoEl=a;const o=()=>{if(!this._currentVideoEl||this._isPaused||!this._isViewing)return;const d=this._currentVideoEl.duration||0,c=this._currentVideoEl.currentTime||0;this._progressMs=d?c*1e3:0,this._progressFraction=d?Math.min(1,c/d):0,this.requestUpdate(),this._videoRafId=window.requestAnimationFrame(o)},h=()=>{this._videoRafId&&(window.cancelAnimationFrame(this._videoRafId),this._videoRafId=null),this._next()};if(this._onVideoEnded=h,this._currentVideoEl.addEventListener("ended",h),!this._isPaused){try{await this._currentVideoEl.play()}catch(d){}this._videoRafId=window.requestAnimationFrame(o)}return}const i=Math.max(0,this._storyDuration-this._progressMs),e=performance.now()-this._progressMs,r=a=>{if(this._isPaused||!this._isViewing)return;const o=a-e;this._progressMs=Math.min(this._storyDuration,o),this._progressFraction=this._progressMs/this._storyDuration,this.requestUpdate(),this._progressMs>=this._storyDuration?(this._rafId=null,this._autoTimer=window.setTimeout(()=>this._next(),0)):this._rafId=window.requestAnimationFrame(r)};this._rafId=window.requestAnimationFrame(r),this._autoTimer=window.setTimeout(()=>{!this._isPaused&&this._isViewing&&(this._progressMs=this._storyDuration,this._progressFraction=1,this.requestUpdate(),this._next())},i+30)}_stopProgressKeepPosition(){if(this._rafId&&(window.cancelAnimationFrame(this._rafId),this._rafId=null),this._autoTimer&&(window.clearTimeout(this._autoTimer),this._autoTimer=null),this._currentVideoEl)try{this._currentVideoEl.pause()}catch(t){}this._videoRafId&&(window.cancelAnimationFrame(this._videoRafId),this._videoRafId=null)}_clearTimers(){if(this._rafId&&(window.cancelAnimationFrame(this._rafId),this._rafId=null),this._autoTimer&&(window.clearTimeout(this._autoTimer),this._autoTimer=null),this._cleanupTimer&&(window.clearTimeout(this._cleanupTimer),this._cleanupTimer=null),this._currentVideoEl&&this._onVideoEnded)try{this._currentVideoEl.removeEventListener("ended",this._onVideoEnded)}catch(t){}if(this._currentVideoEl)try{this._currentVideoEl.pause()}catch(t){}this._videoRafId&&(window.cancelAnimationFrame(this._videoRafId),this._videoRafId=null),this._currentVideoEl=null,this._onVideoEnded=null}_onViewerTouchStart(t){if(!this._isViewing)return;const i=t.touches[0];this._touch.active=!0,this._touch.startX=i.clientX,this._touch.startY=i.clientY,this._touch.lastX=i.clientX,this._touch.lastY=i.clientY,this._touch.startTime=performance.now(),this._touch.moved=!1,this._isPaused?this._wasPausedByTouch=!1:(this._togglePause(),this._wasPausedByTouch=!0)}_onViewerTouchMove(t){if(!this._touch.active)return;const i=t.touches[0],e=i.clientX-this._touch.startX,r=i.clientY-this._touch.startY;this._touch.lastX=i.clientX,this._touch.lastY=i.clientY,Math.hypot(e,r)>10&&(this._touch.moved=!0)}_onViewerTouchEnd(t){if(!this._touch.active)return;const i=this._touch.lastX-this._touch.startX,e=this._touch.lastY-this._touch.startY,r=performance.now()-this._touch.startTime,s=Math.abs(i),a=Math.abs(e),o=s>50&&s>a,h=r<200&&Math.hypot(i,e)<30;if(o)(!this._isPaused||this._wasPausedByTouch)&&(i<0?this._next():this._prev());else if(h){const d=this._touch.startX,c=window.innerWidth/3;!this._isPaused||this._wasPausedByTouch?d<c?this._prev():d>2*c?this._next():this._handleNavigateCurrent():d>=c&&d<=2*c&&this._handleNavigateCurrent()}this._wasPausedByTouch&&this._isPaused&&this._togglePause(),this._touch.active=!1,this._wasPausedByTouch=!1}_onViewerClick(t){var s;if(!this._isViewing||(((s=t.composedPath)==null?void 0:s.call(t))||[]).some(a=>{var o,h;return(h=(o=a==null?void 0:a.classList)==null?void 0:o.contains)==null?void 0:h.call(o,"btn")}))return;const e=t.clientX,r=window.innerWidth/3;this._isPaused?e>=r&&e<=2*r&&this._handleNavigateCurrent():e<r?this._prev():e>2*r?this._next():this._handleNavigateCurrent()}handleNavigate(t){if(!window.TMA||typeof window.TMA.navigate!="function"){console.warn("TMA.navigate is not available");return}const{NavigateVar:i,NavigateParams:e,OptionalHref:r}=t;try{if(e&&typeof e=="string"&&e.startsWith("game/")){const s=e.split("/");if(s.length===3&&s[1]&&s[2]){const[,a,o]=s;window.TMA.navigate("GAME",{gameStudio:a,gameSlug:o});return}}if(i&&i!=="NULL"&&i!=="null"){window.TMA.navigate(i);return}console.debug("No TMA navigation triggered, relying on OptionalHref:",r)}catch(s){console.error("Error processing navigation:",s)}}_handleNavigateCurrent(){const t=this.slides[this._currentIndex];try{this.handleNavigate(t),t!=null&&t.OptionalHref&&typeof t.OptionalHref=="string"&&(window.location.href=t.OptionalHref)}catch(i){console.error("Navigation error:",i)}}_renderProgressBars(){const t=this.slides.length,i=this._currentIndex;return l(T||(T=n(['\n      <div class="progress">\n        ',"\n      </div>\n    "])),Array.from({length:t}).map((e,r)=>{let s=0;return r<i?s=100:r===i?s=Math.round(this._progressFraction*100):s=0,l(y||(y=n(['\n            <div class="bar">\n              <div class="fill" style="width:','%"></div>\n            </div>\n          '])),s)}))}_renderStage(){var d,c;const t=this.slides[this._currentIndex],i=(d=this._transition)==null?void 0:d.prevIndex,e=typeof i=="number"?this.slides[i]:null,r=(c=this._transition)==null?void 0:c.direction,s=this._transition?r==="right"?"img-layer enter-right":"img-layer enter-left":"img-layer active",a=this._transition?r==="right"?"img-layer active exit-left":"img-layer active exit-right":"",o=!!e&&this.isVideoSlide(e),h=!!t&&this.isVideoSlide(t);return l(M||(M=n(['\n      <div\n        class="stage"\n        style="--bg-url: url(\'',"');\"\n        @click=","\n      >\n        ","\n        ",'\n        <div class="hit-areas" aria-hidden="true">\n          ','\n          <div class="hit"></div>\n          <div class="hit"></div>\n          <div class="hit"></div>\n        </div>\n      </div>\n    '])),this._thumbUrl(t),this._onViewerClick,e?l(P||(P=n(["\n              <div class=",">\n                ","\n              </div>\n            "])),a,o?l(V||(V=n(['<video\n                      class="img-el"\n                      src=','\n                      muted\n                      preload="metadata"\n                      playsinline\n                    ></video>'])),this._fullUrl(e)):l(k||(k=n(['<img\n                      class="img-el"\n                      src=','\n                      alt=""\n                    />'])),this._fullUrl(e))):null,t?l($||($=n(["\n              <div\n                class=","\n                style=","\n                @transitionend=","\n              >\n                ","\n              </div>\n            "])),s,(this._transition,""),this._onStageTransitionEnd,h?l(I||(I=n(['<video\n                      id="currentVideo"\n                      class="img-el"\n                      src=',"\n                      muted\n                      playsinline\n                      autoplay\n                    ></video>"])),this._fullUrl(t)):l(E||(E=n(['<img\n                      class="img-el"\n                      src=','\n                      alt=""\n                    />'])),this._fullUrl(t))):null,t!=null&&t.caption?l(S||(S=n(['<div class="caption">',"</div>"])),t.caption):null)}render(){var t;return this._loading?l(N||(N=n(['<div class="loading">Loading...</div>']))):this._error?l(A||(A=n([' <div class="loading">Loading...</div> ']))):(t=this.slides)!=null&&t.length?l(C||(C=n(["\n      ","\n    "])),this._isViewing?this._renderViewer():this._renderThumbnails()):l(X||(X=n(['<div class="loading">No stories found.</div>'])))}_renderThumbnails(){return l(O||(O=n(['\n      <div class="thumbs">\n        ',"\n      </div>\n    "])),this.slides.map((t,i)=>{const e=this._viewed.has(i);return l(L||(L=n(['\n            <div class="thumb">\n              <button\n                class="thumb-btn"\n                @click=','\n                aria-label="Open story"\n              >\n                <div class="thumb-img-wrap ','">\n                  <img\n                    class="thumb-img"\n                    src=','\n                    alt=""\n                    loading="lazy"\n                  />\n                </div>\n                ',"\n              </button>\n            </div>\n          "])),()=>this._openViewer(i),e?"":"unviewed",this._thumbUrl(t),t.Georgians===!0?l(F||(F=n(['<div class="thumb-checkmark"></div>']))):"")}))}_renderViewer(){return l(U||(U=n(['\n      <div class="viewer">\n        <div class="top-bar">\n          ','\n          <div class="controls">\n            <button\n              class="btn play-pause"\n              @click=','\n              aria-label="Pause/Play"\n            >\n              ','\n            </button>\n            <button\n              class="btn close"\n              @click=','\n              aria-label="Close"\n            >\n              ×\n            </button>\n          </div>\n        </div>\n        ',"\n      </div>\n    "])),this._renderProgressBars(),this._togglePause,this._isPaused?"▶":"⏸",this._closeViewer,this._renderStage())}}p(g,"properties",{locale:{type:String},slides:{type:Array},_isViewing:{state:!0},_currentIndex:{state:!0},_isPaused:{state:!0},_progressMs:{state:!0},_progressFraction:{state:!0},_transition:{state:!0},_loading:{state:!0},_error:{state:!0}}),p(g,"styles",R(x||(x=n(['\n    :host {\n      display: block;\n      color: #fff;\n    }\n\n    /* Thumbnails row */\n    .thumbs {\n      display: flex;\n      gap: 8px;\n      overflow-x: auto;\n      padding: 12px;\n      scrollbar-width: thin;\n      -webkit-overflow-scrolling: touch;\n      background: #000;\n    }\n    .thumb {\n      flex: 0 0 auto;\n      width: fit-content;\n      text-align: center;\n      position: relative;\n    }\n    .thumb-img-wrap {\n      width: 90px;\n      height: 120px;\n      border-radius: 12px;\n      overflow: hidden;\n      border: 2px solid transparent;\n      outline: 2px solid gray;\n      box-sizing: border-box;\n      position: relative;\n    }\n    .thumb-img-wrap.unviewed {\n      outline: 2px solid #993463;\n    }\n    .thumb:has(.unviewed) {\n      --thumb-checkmark-bg: #993463;\n    }\n    .thumb-img {\n      width: 100%;\n      height: 100%;\n      object-fit: cover;\n      display: block;\n      background: #222;\n    }\n    .thumb-cap {\n      margin-top: 6px;\n      font-size: 11px;\n      color: #bbb;\n      max-width: 80px;\n      word-break: break-word;\n    }\n    .thumb-btn {\n      all: unset;\n      cursor: pointer;\n      display: inline-block;\n    }\n    .thumb-checkmark::before {\n      content: "#Georgians";\n      display: inline-block;\n      padding: 2px 20px 2px 6px;\n      background: var(--thumb-checkmark-bg, gray)\n        url(https://www.ambassadoribet.com/_internal/ts-images/5da2b4d5-59f6-412a-82c3-f6a272b532be/dev/6355bde9-b143-40af-afc1-9d8d5eada880/flag-for-flag-georgia-svgrepo-com.svg)\n        no-repeat right 4px center;\n      background-size: 12px auto;\n      border-radius: 64px;\n      color: #fff;\n      font-size: 8px;\n      line-height: 10px;\n      font-weight: 400;\n      font-family: "Noto Sans Ambassadori";\n      text-align: center;\n      position: absolute;\n      left: 50%;\n      top: -5px;\n      transform: translateX(-50%);\n    }\n\n    /* Fullscreen viewer */\n    .viewer {\n      position: fixed;\n      inset: 0;\n      background: #000;\n      display: flex;\n      flex-direction: column;\n      z-index: 2147483647;\n      perspective: 1000px;\n      overflow: hidden;\n      touch-action: none; /* we implement gestures */\n    }\n\n    /* Top controls row */\n    .top-bar {\n      position: absolute;\n      top: 10px;\n      left: 10px;\n      right: 10px;\n      display: flex;\n      align-items: center;\n      gap: 8px;\n      z-index: 3;\n      pointer-events: none;\n    }\n\n    .progress {\n      display: flex;\n      gap: 4px;\n      flex: 1 1 auto;\n      pointer-events: auto;\n    }\n    .bar {\n      position: relative;\n      height: 2px;\n      background: rgba(255, 255, 255, 0.3);\n      flex: 1 1 0;\n      overflow: hidden;\n      border-radius: 2px;\n    }\n    .bar .fill {\n      position: absolute;\n      left: 0;\n      top: 0;\n      height: 100%;\n      width: 0%;\n      background: #fff;\n      will-change: width;\n    }\n    .controls {\n      display: flex;\n      gap: 8px;\n      pointer-events: auto;\n    }\n    .btn {\n      all: unset;\n      color: #fff;\n      font-size: 20px;\n      cursor: pointer;\n      padding: 6px 10px;\n      background: rgba(255, 255, 255, 0.08);\n      border-radius: 8px;\n      line-height: 1;\n      user-select: none;\n      font-family: "Noto Sans Ambassadori Bold";\n      height: fit-content;\n      width: 25px;\n      text-align: center;\n    }\n    .btn:active {\n      transform: scale(0.98);\n    }\n\n    /* Image stage */\n    .stage {\n      position: relative;\n      width: 100vw;\n      height: 100vh;\n      display: grid;\n      place-items: center;\n      z-index: 1;\n    }\n    .img-layer {\n      position: absolute;\n      inset: 0;\n      display: grid;\n      place-items: center;\n      overflow: visible; /* allow 3D transforms to show */\n      backface-visibility: hidden;\n      will-change: transform, opacity;\n      transition: transform 0.4s ease-in-out, opacity 0.4s ease-in-out;\n      background-image: var(--bg-url);\n      background-size: cover;\n      background-position: center;\n    }\n    .img-el {\n      max-width: 80vw;\n      max-height: 80vh;\n      object-fit: contain;\n      display: block;\n      background: #111;\n      border-radius: 8px;\n      box-shadow: 0 0px 130px rgba(0, 0, 0, 1), 0 0px 130px rgba(0, 0, 0, 1);\n    }\n    .caption {\n      position: absolute;\n      top: 50px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: 90vw;\n      text-align: center;\n      color: #fff;\n      font-size: 15px;\n      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.6);\n      z-index: 2;\n      background-color: rgba(0, 0, 0, 0.5);\n      padding: 4px 8px;\n      border-radius: 8px;\n      font-family: "Noto Sans Ambassadori";\n    }\n\n    /* 3D transition states */\n    .active {\n      transform: translateX(0) rotateY(0deg);\n      opacity: 1;\n    }\n    .enter-right {\n      transform: translateX(100%) rotateY(60deg);\n      opacity: 0;\n    }\n    .enter-left {\n      transform: translateX(-100%) rotateY(-60deg);\n      opacity: 0;\n    }\n    .exit-left {\n      transform: translateX(-100%) rotateY(-60deg);\n      opacity: 0;\n    }\n    .exit-right {\n      transform: translateX(100%) rotateY(60deg);\n      opacity: 0;\n    }\n\n    /* Overlay click/touch regions (for prev/next/middle) */\n    .hit-areas {\n      position: absolute;\n      inset: 0;\n      display: grid;\n      grid-template-columns: 1fr 1fr 1fr;\n      z-index: 2;\n    }\n    .hit {\n      /* invisible areas to receive clicks */\n      display: block;\n    }\n\n    /* Loading */\n    .loading {\n      color: #ccc;\n      padding: 16px;\n      font-size: 14px;\n      background: #000;\n    }\n  ']))));customElements.define("stories-carousel",g);export{B as __vite_legacy_guard};
//# sourceMappingURL=stories.js.map
